//=======================================================================
//driver ic:
//LCD:
//interface:4-SPI
//dots:
//author:ZD
//***************************************************************************
#include "k096.h"





/* 字符0----9字库*/
/* zifu为二维数组，10行240列，每行存放一个数字字符*/
unsigned char  zifu[10][111]=
{
   /*--  文字:  0  --*/
  { /*--  米字体;  此字体下对应的像素点为：长x宽=20*40   --*/	
0x00,0x00,0x00,0x1F,0xFF,0x80,0x1F,0xFF,0x80,0x1F,0xFF,0x00,0xEF,0xFE,0x70,0xF7,0xFE,0xF0,0xF3,0xFD,0xF0,0xF9,0xFD,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,
0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0x70,0x00,0xE0,0x20,0x00,0x40,0x70,0x00,0xE0,0x70,0x01,0xE0,0xF8,
0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xFB,0xFE,0xF0,0xF7,0xFE,0xF0,0xEF,0xFF,0x70,
0x1F,0xFF,0x00,0x1F,0xFF,0x80,0x1F,0xFF,0x80,0x1F,0xFF,0x80,0x00,0x00,0x00/*"0",0*/

  },

   /*--  文字:  1  --*/
{/*--  宋体;  此字体下对应的像素点为：长x宽=32*60   --*/

0x00,0x00,0x00,0x7C,0x00,0x00,0x7C,0x80,0x00,0xF9,0x80,0x00,0xF3,0x80,0x00,0x77,0x80,0x00,0x6F,0x80,0x00,0x4F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,
0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x07,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00,0x02,0x00,0x00,0x07,0x00,0x00,0x07,
0x00,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,0x0F,0x80,0x00,
0x0F,0x80,0x00,0x0F,0x80,0x00,0x07,0x00,0x00,0x02,0x00,0x00,0x00,0x00,0x00/*"1",0*/


},
   /*--  文字:  2 --*/
{  /*--  宋体;  此字体下对应的像素点为：长x宽=32*60   --*/
0x00,0x00,0x00,0x3F,0xFF,0xC0,0x7F,0xFF,0xC0,0x7F,0xFF,0xB0,0xFF,0xFF,0xF0,0x7F,0xFF,0x70,0x7F,0xFE,0xF0,0x3F,0xFC,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,
0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x0F,0xFC,0xF0,0x1F,0xFE,0xF0,0x1F,0xFF,0x70,0x1F,0xFF,0x80,0x6F,0xFF,0x80,0x67,0xFF,0x80,0xF7,
0xFF,0x80,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF0,0x00,0x00,0xF7,0xFF,0xC0,0xEF,0xFF,0xE0,0xCF,0xFF,0xE0,
0xDF,0xFF,0xF0,0x3F,0xFF,0xE0,0x3F,0xFF,0xE0,0x3F,0xFF,0xC0,0x00,0x00,0x00/*"2",0*/

},


  /*--  文字:  3 --*/
{  /*--  宋体;  此字体下对应的像素点为：长x宽=32*60   --*/
0x00,0x00,0x00,0x3F,0xFF,0xC0,0x7F,0xFF,0xC0,0x7F,0xFF,0xF0,0xFF,0xFF,0xB0,0x7F,0xFF,0x70,0x7F,0xFE,0xF0,0x3F,0xFE,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,
0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x3F,0xFD,0xF0,0x7F,0xFF,0xF0,0x7F,0xFE,0xE0,0xFF,0xFF,0x40,0x7F,0xFE,0x60,0x7F,0xFE,0xF0,0x3F,
0xFD,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x3F,0xFE,0xF0,0x7F,0xFF,0x70,0x7F,0xFF,0x70,
0xFF,0xFF,0xB0,0x7F,0xFF,0xC0,0x7F,0xFF,0xC0,0x3F,0xFF,0xC0,0x00,0x00,0x00/*"3",0*/

},



  /*--  文字:  4 --*/
{  /*--  宋体;  此字体下对应的像素点为：长x宽=32*60   --*/
0x20,0x00,0x40,0x70,0x00,0xE0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,
0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0x79,0xFD,0xF0,0x3B,0xFF,0xF0,0x37,0xFE,0xE0,0x0F,0xFF,0x40,0x07,0xFE,0xE0,0x03,0xFE,0xF0,0x01,
0xFD,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,
0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x00,0xE0,0x00,0x00,0x40,0x00,0x00,0x00/*"4",0*/

},


  /*--  文字:  5 --*/
{ /*--  宋体;  此字体下对应的像素点为：长x宽=32*60   --*/
0x00,0x00,0x00,0xFF,0xFF,0xE0,0x9F,0xFF,0xE0,0xDF,0xFF,0xF0,0xEF,0xFF,0xF0,0xF7,0xFF,0xF0,0xF3,0xFF,0xE0,0xF9,0xFF,0xE0,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,
0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0x7B,0xFC,0x00,0x37,0xFE,0x00,0x2F,0xFE,0x00,0x1F,0xFF,0x00,0x0F,0xFE,0x00,0x07,0xFE,0xC0,0x03,0xFD,0xE0,0x00,
0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x3F,0xFE,0xF0,0x7F,0xFE,0xF0,0x7F,0xFF,0x70,
0xFF,0xFF,0xA0,0x7F,0xFF,0x80,0x7F,0xFF,0x80,0x3F,0xFF,0x00,0x00,0x00,0x00/*"5",0*/

},


  /*--  文字:  6 --*/
{ /*--  宋体;  此字体下对应的像素点为：长x宽=32*60   --*/
0x00,0x00,0x00,0x1F,0xFF,0xC0,0x1F,0xFF,0xE0,0x1F,0xFF,0xE0,0xEF,0xFF,0xF0,0xF7,0xFF,0xE0,0xF3,0xFF,0xE0,0xF9,0xFF,0xC0,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,
0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xFB,0xFC,0x00,0xFF,0xFE,0x00,0x77,0xFF,0x00,0x2F,0xFF,0x00,0x77,0xFF,0x00,0x7F,0xFE,0xC0,0xFB,
0xFC,0xE0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xFB,0xFE,0xF0,0xF7,0xFE,0xF0,0xEF,0xFF,0x70,
0x1F,0xFF,0x00,0x1F,0xFF,0x80,0x1F,0xFF,0x80,0x1F,0xFF,0x80,0x00,0x00,0x00/*"6",0*/

},

  /*--  文字:  7 --*/
{  /*--  宋体;  此字体下对应的像素点为：长x宽=32*60   --*/
0x00,0x00,0x00,0x3F,0xFF,0xC0,0x7F,0xFF,0x80,0x7F,0xFF,0xB0,0xFF,0xFF,0x30,0x7F,0xFE,0x70,0x7F,0xFE,0xF0,0x3F,0xFD,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,
0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x00,0xE0,0x00,0x00,0x40,0x00,0x00,0xE0,0x00,0x00,0xE0,0x00,
0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,
0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x00,0xE0,0x00,0x00,0x40,0x00,0x00,0x00/*"7",0*/

},
	
  /*--  文字:  8  --*/
{  /*--  宋体;  此字体下对应的像素点为：长x宽=32*60   --*/
0x00,0x00,0x00,0x0F,0xFF,0x00,0x1F,0xFF,0x80,0x1F,0xFF,0x00,0xEF,0xFF,0x70,0xF7,0xFE,0xF0,0xF3,0xFD,
0xF0,0xF9,0xFD,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,
0x01,0xF0,0xF8,0x01,0xF0,0xFB,0xFD,0xF0,0xFF,0xFF,0xF0,0x77,0xFE,0xE0,0x2F,0xFF,0x40,0x77,0xFE,0xE0,
0x7F,0xFF,0xF0,0xFB,0xFD,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,
0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xFB,0xFC,0xF0,0xF7,0xFE,0xF0,0xEF,0xFF,0x70,0x1F,0xFF,0x00,0x1F,
0xFF,0x80,0x1F,0xFF,0x00,0x0F,0xFE,0x00,0x00,0x00,0x00/*"8",0*/
},
  /*--  文字:  9 --*/
{  /*--  宋体;  此字体下对应的像素点为：长x宽=32*60   --*/
0x00,0x00,0x00,0x0F,0xFF,0x00,0x1F,0xFF,0x80,0x1F,0xFF,0x00,0xEF,0xFF,0x70,0xF7,0xFE,0xF0,0xF3,0xFD,0xF0,0xF9,0xFD,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,
0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xF8,0x01,0xF0,0xFB,0xFD,0xF0,0xF7,0xFF,0xF0,0x67,0xFE,0xE0,0x2F,0xFF,0x40,0x07,0xFE,0xE0,0x07,0xFF,0xF0,0x03,
0xFD,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x00,0x01,0xF0,0x3F,0xFC,0xF0,0x7F,0xFE,0xF0,0x7F,0xFF,0x70,
0xFF,0xFF,0x00,0x7F,0xFF,0x80,0x7F,0xFF,0x00,0x3F,0xFE,0x00,0x00,0x00,0x00/*"9",0*/
}

};



//******************************************************************
void delay(unsigned int t)
{
	unsigned int t1;
	while(t--)
	{
		for(t1=10; t1>0; t1--)
	        {
	          ;
	        }
	}
}

//******************************************************************
void write_command(unsigned char idat)    //送数据子程式
{
    unsigned char a,i;
    //CS_H;
    
    DC_L;
	CS_L;
    a=idat;
    for(i=0;i<8;i++) {
        SCL_L;
        if((a&0x80) == 0x80)
            MOSI_H;
        else
            MOSI_L;
	delay(1);
        SCL_H;
        a <<= 1;
    }
    CS_H;
DC_H;
}


void write_data(unsigned char ddat)
{
    unsigned char a,i;
    //CS_H;

    DC_H;
    CS_L;
	
    a=ddat;
    for(i=0;i<8;i++) {
        SCL_L;
        if((a&0x80) == 0x80)
            MOSI_H;
        else
            MOSI_L;
		delay(1);
        SCL_H;
        a <<= 1;
    }
    CS_H;
	DC_H;
}


//************************
//颜色设置函数
//    
//************************
void send_color(unsigned char Color)
{
	unsigned char color=0;
	color=Color;
	switch(color)
	{
		case 0:{write_data(0x00);write_data(0x00);break;}/*黑 色*/
		case 1:{write_data(0x00);write_data(0x1f);break;}/*蓝 色*/
		case 2:{write_data(0xf8);write_data(0x00);break;}/*红 色*/
		case 3:{write_data(0xff);write_data(0xff);break;}/*白色*/
		case 4:{write_data(0x07);write_data(0xe0);break;}/*绿色*/
		case 5:{write_data(0xff);write_data(0xe0);break;}/*黄色*/
		case 6:{write_data(0xf8);write_data(0x1f);break;}/*品红色*/
		case 7:{write_data(0x07);write_data(0xff);break;}/*青色*/
		
	}
}


//************************
//清屏函数
//    
//************************
void LCD_Clear(void)
{
        /*发送清屏指令*/
	 write_command(0x25);	
        /*设置清屏区域*/
        write_command(0x00);	//清屏列首地址
	 write_command(0x00);	//清屏行首地址
        write_command(0x5f);	//清屏列尾地址
	 write_command(0x3f);	//清屏行尾地址       
}


//************************
//坐标设置函数
//    
//************************
void addset(unsigned char x)  //坐标设置  参x 表示数字的横坐标
{
    	write_command(0x15);	//set column address 设显示长度
        write_command(x);	       //column address start 00
	write_command(x+0x17);	//column address end 95

	write_command(0x75);	//set row address 设显示宽度
	write_command(0x0c);	//row address start 00
	write_command(0x3f);	//row address end 63	
}


//在指定位置显示一个字符(32*60大小)
//dcolor为内容颜色，bgcolor为背静颜色
void showzifu(unsigned char x,  unsigned char value, unsigned char dcolor,  unsigned char bgcolor)
{ 
	unsigned char i,j;  
        addset(x); //设置区域      
	for(j=0;j<111;j++)
	{
		for(i=0;i<8;i++)
		{ 		     
		 	if((zifu[value][j]&(1<<(7-i)))!=0)
			{
				send_color(dcolor);
			} 
			else
			{
				send_color(bgcolor);
			}   
		}

	}
}

//刷白色
void display_w (void)						
{
	word k,i;

	for(k=0;k<64;k++)
	{
		for(i=0;i<96;i++)
		{	write_data(0xff);
			write_data(0xff);
	}
   }
}

/*************************************************/
void initi_oled(void)         //LCM初始化
{
//   RST_H;
//   delay(1);
   RST_L;
   delay(100);
   RST_H;
   delay(500);

//***************************************************************************************
      write_command(0x00);
      delay(100);

      write_command(0xfd);	// command lock
	write_command(0x12);

	write_command(0xae);	// display off

	write_command(0xa4); 	// Normal Display mode

	write_command(0x15);	//set column address 设显示长度
        write_command(0x00);	//column address start 00
	write_command(0x5f);	//column address end 95

	write_command(0x75);	//set row address 设显示宽度
	write_command(0x00);	//row address start 00
	write_command(0x3f);	//row address end 63	

	write_command(0x87);	//master current control
        write_command(0x06);	//9/16(160uA)---可以调整亮度


	write_command(0x83);	//Set Contrast for Color R
	write_command(0xc0);

	write_command(0x82);	//Set Contrast for Color G
	write_command(0x65);

	write_command(0x81);	//Set Contrast for Color B
	write_command(0x95);

	write_command(0x8a);
	write_command(0x61);
	write_command(0x8b);
	write_command(0x62);
	write_command(0x8c);
	write_command(0x63);


	write_command(0xa0);	//set re-map & data format,设描绘方向
	write_command(0x72);	//Horizontal address increment

	write_command(0xa1);	//set display start line
	write_command(0x00);	//start 00 line

	write_command(0xa2);	//set display offset
	write_command(0x00);

	write_command(0xa8);	//set multiplex ratio
	write_command(0x3f);	//64MUX

	write_command(0xad);
	write_command(0x8f);



	write_command(0xb0);	//set power save
	write_command(0x1a);	//

	write_command(0xb1);
	write_command(0x74);	// Phase 2 period Phase 1 period---能够影响亮度及灰度

	write_command(0xb3);	// Set Display Clock Divide Ratio/ Oscillator Frequency
	write_command(0xd0);	// 0.97MHZ

	write_command(0xbb);	// set pre-charge
	write_command(0x3e);	//   ---设置充电电压的目标值

	write_command(0xbe);	//set Vcomh
	write_command(0x3e);	//0.83Vref


	write_command(0xB9);

 
	write_command(0xad);	//Select external VCC supply at Display ON
	write_command(0x8e); 	//Select External VP voltage supply

	write_command(0xaf);	 //display on

}



//******************************************************************
